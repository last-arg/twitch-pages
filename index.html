<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Twitch Alternative</title>
    <!--
      TODO: for some reason icons.svg is downloaded twice
      After few seconds console warns of not using preloaded svg
    -->
    <link rel="preload" href="/src/assets/icons.svg" as="image" type="image/svg+xml" />
    <style>
      /* Don't flash big svg icons */
      svg {
        width: 1em;
        height: 1em;
      }
    </style>
  </head>
  <body class="bg-trueGray-50 text-trueGray-800">
    <div id="app">
      <header class="fixed top-0 w-full z-10 bg-gray-700">
        <div class="relative bg-gray-700  max-w-screen-2xl mx-auto px-3">
          <div x-data="sidebar" class="flex shadow-md justify-between">
            <nav class="flex w-full">
              <h1>
                <a href="/"
                  class="block px-3 pt-1.5 pb-0.5 bg-gray-900 text-gray-50
                    border-b-5 border-gray-900
                    hover:text-gray-50 hover:border-violet-700
                    focus:border-violet-700 focus:text-gray-50
                  "
                  x-on:click.prevent="$dispatch('set-main', {path: '/', getUrl: '/partials/top-games.html'})"
                >Home</a>
              </h1>
              <div class="ml-auto border-b-5 border-gray-900 mr-3 sm:mr-5"
                :class="state === 'search' ? 'border-violet-700' : ''"
              >
                <form role="search" class="h-full flex" x-on:click.prevent="">
                  <label class="sr-only" for="game_name">Enter game name</label>
                  <input
                    x-on:focus="state = 'search'"
                    x-on:blur="if ($el.value.length === 0) state = 'closed'"
                    x-on:keyup.enter="if ($el.value.length) $dispatch('submit')"
                    x-ref="searchInput"
                    x-model="searchValue"
                    id="game_name"
                    name="game_name"
                    type="search"
                    class="bg-gray-200 h-full border-t border-gray-900 hover:bg-gray-50 focus:bg-gray-50 px-1 align-top w-full"
                    placeholder="Search for game"
                  />
                  <button class="px-2.5 pt-1 text-gray-200 bg-gray-900 h-full hover:text-gray-50 focus:text-gray-50"
                    type="submit" aria-label="Search games"
                    x-on:click="$refs.searchInput.focus()"
                  >
                    <svg class="fill-current w-5 h-5"><use href="/src/assets/icons.svg#looking-class"></use></svg>
                  </button>
                </form>
              </div>
              <!-- games button -->
              <button
                x-on:click="toggleSidebar('games')"
                class="mr-3 sm:mr-5 text-gray-200 block bg-gray-900 px-3 pt-1.5 pb-0.5 hover:text-gray-50 focus:text-gray-50 border-b-5 border-gray-900 block"
                :class="state === 'games' ? 'border-violet-700' : ''"
                aria-label="My games"
                aria-haspopup="true"
                :aria-expanded="(state === 'games').toString()"
              >
                <svg class="fill-current w-5 h-5">
                  <use href="/src/assets/icons.svg#game-controller"></use>
                </svg>
              </button>
              <!-- games sidebar -->
              <div class="sidebar-wrapper"
                x-show="state === 'games'"
                x-transition:enter-start="translate-x-1/4 opacity-0"
                x-transition:enter-end="translate-x-0 opacity-100"
                x-transition:leave="translate-x-1/4 opacity-0"
              >
                <div class="flex flex-col bg-trueGray-700 h-full pb-4">
                  <div class="flex justify-between mb-4">
                    <h2 class="flex items-center bg-violet-700 px-3 py-1 font-bold text-trueGray-100">
                      <svg class="fill-current w-4 h-4 mr-2">
                        <use href="/src/assets/icons.svg#game-controller"></use>
                      </svg>
                      Games
                    </h2>
                    <button type="button"
                      class="block bg-violet-700 px-2.5 text-trueGray-100
                        opacity-70 hover:opacity-100 focus:opacity-100
                      "
                      x-on:click="state = 'closed'"
                    >
                      <span class="sr-only">Close sidebar</span>
                      <svg class="fill-current w-4 h-4">
                        <use href="/src/assets/icons.svg#close"></use>
                      </svg>
                    </button>
                  </div>
                  <!-- @games -->
                  <div class="overflow-y-auto">
                    <ul class="stack stack-m-4">
                      <template x-for="game in $store.games.data" :key="game.id">
                        <li class="flex">
                          <a class="flex items-center flex-grow pl-1.5 bg-gray-800
                              text-trueGray-300
                              border-l-6 border-transparent
                              hover:text-gray-50 hover:border-violet-700
                              focus:text-gray-50 focus:border-violet-700
                            "
                            :href="`/directory/game/${game.name}`"
                            x-on:click.prevent="$dispatch('set-main', {path: `/directory/game/${game.name}`, getUrl: '/partials/category.html'})">
                            <img class="w-14 mr-2" :src="getImageSrc(game.name, $el.width, $el.height)" alt="" width="104" height="144" />
                            <p x-text="game.name"></p>
                          </a>
                          <div class="flex flex-col justify-between bg-gray-800 ml-px text-trueGray-400 px-1.5 py-1.5">
                            <button class="hover:text-violet-500"
                              x-on:click="$store.games.remove(game.id)" type="button" aria-label="Unfollow"
                            >
                              <svg class="fill-current w-5 h-5">
                                <use href="/src/assets/icons.svg#star-full"></use>
                              </svg>
                            </button>
                            <a class="hover:text-violet-500" :href="`https://www.twitch.tv/directory/game/${game.name}`">
                              <svg class="fill-current w-5 h-5">
                                <use href="/src/assets/icons.svg#external-link"></use>
                              </svg>
                            </a>
                          </div>
                        </li>
                      </template>
                    </ul>
                  </div>
                </div>
              </div>
              <button
                x-on:click="toggleSidebar('streams')"
                class="text-gray-200 block bg-gray-900 px-3 pt-1.5 pb-0.5
                  hover:text-gray-50 focus:text-gray-50
                  border-b-5 border-gray-900 block
                "
                :class="state === 'streams' ? 'border-violet-700' : ''"
                aria-label="Streams"
              >
                <svg class="fill-current w-5 h-5"><use href="/src/assets/icons.svg#people"></use></svg>
              </button>
              <div x-show="state === 'streams' && state === 'search'"
                class="pb-2 pt-11 h-screen absolute top-0 right-0 max-w-xs w-full -z-10 transition duration-300 transform"
                x-transition:enter-start="translate-x-1/4 opacity-0"
                x-transition:enter-end="translate-x-0 opacity-100"
                x-transition:leave="translate-x-1/4 opacity-0"
              >
                <div class="bg-gray-700 text-gray-100 shadow-md flex flex-col h-full pb-4">
                  <div class="flex justify-between mb-4">
                    <div class="flex items-center bg-violet-700 px-3 py-1 font-bold">
                      <svg class="fill-current w-4 h-4 mr-2">
                        <use x-data="{iconId: 'games'}"
                          x-effect="if (state !== 'closed') iconId = sidebarToSvgIconId(state)"
                          :href="`/src/assets/icons.svg#${iconId}`"
                        ></use>
                      </svg>
                      <h2 x-text="title"></h2>
                    </div>
                    <button type="button" aria-label="Close sidebar"
                      class="block bg-violet-700 px-2.5 text-gray-50 opacity-70 hover:opacity-100 focus:opacity-100"
                      x-on:click="state = 'closed'"
                    >
                      <svg class="fill-current w-4 h-4">
                        <use href="/src/assets/icons.svg#close"></use>
                      </svg>
                    </button>
                  </div>
                  <div class="overflow-y-auto">
                    <!-- @search -->
                    <ul class="stack stack-m-4" x-show="state === 'search'">
                      <template x-for="game in searchResults" :key="game.id">
                        <li class="flex mt-4">
                          <a class="flex items-center flex-grow pl-1.5 bg-gray-800
                              text-trueGray-300
                              border-l-6 border-transparent
                              hover:text-gray-50 hover:border-violet-700
                              focus:text-gray-50 focus:border-violet-700
                            "
                            :href="`/directory/game/${game.name}`"
                            x-on:click.prevent="$dispatch('set-main', {path: `/directory/game/${game.name}`, getUrl: '/partials/category.html'})">
                            <img class="w-14 mr-2" :src="getImageSrc(game.name, $el.width, $el.height)" alt="" width="104" height="144" />
                            <span x-text="game.name"></span>
                          </a>
                          <div class="flex flex-col justify-between bg-gray-800 ml-px text-trueGray-400 px-1.5 py-1.5">
                            <button x-data="{followed: false}"
                              class="hover:text-violet-500"
                              x-effect="followed = $store.games.hasId(game.id)"
                              x-on:click="$store.games.toggle(game.id)" type="button"
                              :aria-label="followed ? 'UnFollow' : 'Follow'"
                            >
                              <svg class="fill-current w-5 h-5">
                                <use x-show="!followed" href="/src/assets/icons.svg#star-empty"></use>
                                <use x-show="followed" href="/src/assets/icons.svg#star-full"></use>
                              </svg>
                            </button>
                            <a class="hover:text-violet-500" :href="`https://www.twitch.tv/directory/game/${game.name}`">
                              <svg class="fill-current w-5 h-5">
                                <use href="/src/assets/icons.svg#external-link"></use>
                              </svg>
                            </a>
                          </div>
                        </li>
                      </template>
                    </ul>
                    <!-- @streams -->
                    <ul class="stack stack-m-4" x-show="state === 'streams'">
                      <template x-for="stream in $store.streams.data" :key="stream.user_id">
                        <li class="flex">
                          <a class="flex items-center flex-grow pl-1.5 bg-gray-800
                              text-trueGray-300
                              border-l-6 border-transparent
                              hover:text-gray-50 hover:border-violet-700
                              focus:text-gray-50 focus:border-violet-700
                            "
                            :href="`/${stream.user_login}/videos`"
                            x-on:click.prevent="$dispatch('set-main', {path: `/${stream.user_login}/videos`, getUrl: '/partials/user-videos.html'})">
                            <img class="w-16" :src="$store.profile_images.imgUrl(stream.user_id)" alt="" width="300" height="300" />
                            <div class="flex-grow relative h-full flex items-center px-2">
                              <p x-text="stream.user_name"></p>
                              <div class="absolute bottom-0 text-sm flex items-center" x-show="$store.streams.isLive(stream.user_id)">
                                <p><span class="text-xs bg-red-900 opacity-60 rounded-sm px-1 text-trueGray-50">LIVE</span></p>
                                <p class="text-trueGray-400 ml-1 truncate" x-text="$store.streams.live[stream.user_id]"></p>
                              </div>
                            </div>
                          </a>
                          <div class="flex flex-col justify-between bg-gray-800 ml-px text-trueGray-400 px-1.5 py-1.5">
                            <button class="hover:text-violet-500"
                              x-on:click="$store.streams.remove(stream.user_id)" type="button" aria-label="Unfollow"
                            >
                              <svg class="fill-current w-5 h-5">
                                <use href="/src/assets/icons.svg#star-full"></use>
                              </svg>
                            </button>
                            <a class="hover:text-violet-500" :href="`https://www.twitch.tv/directory/${stream.user_login}/videos`">
                              <svg class="fill-current w-5 h-5">
                                <use href="/src/assets/icons.svg#external-link"></use>
                              </svg>
                            </a>
                          </div>
                        </li>
                      </template>
                    </ul>
                  </div>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </header>

      <main class="mt-14 px-3 max-w-screen-2xl mx-auto">
        <div class="hidden text-center mt-8">
          <a class="js-twitch-login bg-violet-700 text-gray-50 px-3 py-2 rouned-sm hover:underline" href="#">Login with Twitch</a>
        </div>
        <div id="main-content"
          x-data="pathContent"
          x-html="html"
        ></div>
      </main>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
