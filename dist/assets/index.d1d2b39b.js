import{m as t}from"./vendor.f11d85c8.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const e={"/":"/partials/top-games.html","/directory/game/:name":"/partials/category.html","/:user/videos":"/partials/user-videos.html","/not-found":"/partials/not-found.html"},i=()=>e[(()=>{let t="/not-found";if("/"===location.pathname)t="/";else{const i=location.pathname.split("/").filter((t=>t.length>0));for(const s of Object.keys(e)){const e=s.split("/").filter((t=>t.length>0));if(0===e.length)continue;if(e.length!==i.length)continue;let a=!0,o={};if(i.forEach(((t,i)=>{":"===e[i][0]?o[e[i].slice(1)]=decodeURIComponent(t):t!==e[i]&&(a=!1)})),a){t=s;break}}}return t})()];function s(e){const s={Host:"api.twitch.tv",Authorization:`Bearer ${e}`,"Client-id":"7v5r973dmjp0nd1g43b8hcocj2airz",Accept:"application/vnd.twitchtv.v5+json"},o=async t=>{if(0===t.length)return[];const e=`https://api.twitch.tv/helix/users?id=${t.join("&id=")}`;return(await(await fetch(e,{method:"GET",headers:s})).json()).data};document.addEventListener("alpine:initializing",(()=>{const e=document.querySelector("#search-feedback");t.data("sidebar",(()=>({state:"games",loading:!1,searchValue:"",searchResults:[],init(){let i=0,s=document.activeElement;t.effect((()=>{var t;"BUTTON"===(null==(t=document.activeElement)?void 0:t.tagName)&&("closed"===this.state?s.focus():s=document.activeElement)})),t.effect((()=>{clearTimeout(i);const t=this.searchValue.trim();t.length>0&&(this.loading=!0,i=setTimeout((async()=>{e.textContent="Searching games",this.searchResults=await this.fetchSearch(t),this.loading=!1,1===this.searchResults.length?e.textContent="Found one game":this.searchResults.length>1?e.textContent=`Found ${this.searchResults.length} games`:e.textContent="Found no games"}),400))}))},async fetchSearch(t){var e;const i=t.trim();if(0===i.length)return[];const a=`https://api.twitch.tv/helix/search/categories?first=10&query=${i}`,o=await fetch(a,{method:"GET",headers:s});return null!=(e=(await o.json()).data)?e:[]},toggleSidebar(t){this.state!==t?this.state=t:this.state="closed"},getImageSrc:(t,e,i)=>a(t,e,i),sidebarToSvgIconId(t){switch(t){case"games":return"game-controller";case"streams":return"people";case"search":return"looking-class"}return""}}))),t.data("category",(function(){return{id:"",name:"",videos:[],cursor:"",loading:!1,async init(){t.effect((()=>{if(this.videos.length>0){const t=Object.keys(this.$store.profile_images.data),e=this.videos.map((t=>t.user_id)).filter((e=>!t.includes(e)));this.$store.profile_images.fetchProfileImages(e)}}));const e=location.pathname.split("/"),i=decodeURIComponent(e[e.length-1]);this.name=i,document.title=i,this.loading=!0;const a=`https://api.twitch.tv/helix/games?name=${i}`,o=(await(await fetch(a,{method:"GET",headers:s})).json()).data;if(o&&o[0]){const t=o[0];this.name=t.name,this.id=t.id,document.title=t.name,this.fetchVideos()}this.loading=!1},async fetchVideos(){var t,e;this.loading=!0;const i=`https://api.twitch.tv/helix/streams?game_id=${this.id}&first=5&after=${this.cursor}`,a=await(await fetch(i,{method:"GET",headers:s})).json();this.videos=[...this.videos,...a.data],this.cursor=null!=(e=null==(t=a.pagination)?void 0:t.cursor)?e:"",this.loading=!1},getImageSrc:(t,e,i)=>a(t,e,i),createLiveUserImageUrl:(t,e,i)=>t.replace("{width}",e.toString()).replace("{height}",i.toString())}}));t.data("user",(function(){return{id:"",name:"",login:"",videos:[],cursor:"",loading:!1,colors:{archive:"bg-lime-200",upload:"bg-sky-200",highlight:"bg-amber-200"},icons:{archive:"video-camera",upload:"video-upload",highlight:"video-reel"},titles:{archive:"Archive",upload:"Upload",highlight:"Highlight"},filterCount:{archive:0,upload:0,highlight:0},filter:{archive:!0,upload:!1,highlight:!1},onlyFilter(t){this.filter.archive=!1,this.filter.upload=!1,this.filter.highlight=!1,this.filter[t]=!0},toggleFilter(t){if(!this.filter[t])return void(this.filter[t]=!0);Object.values(this.filter).reduce(((t,e)=>t+Number(e)),0)>1&&(this.filter[t]=!1)},async init(){var e,i;t.effect((()=>{const t={archive:0,upload:0,highlight:0};for(const e of this.videos)t[e.type]+=1;this.filterCount=t})),this.loading=!0;const a=location.pathname.split("/"),o=decodeURIComponent(a[1]);this.name=o;const n=await(async t=>{if(0===t.length)return;const e=`https://api.twitch.tv/helix/users?login=${t}`;return(await(await fetch(e,{method:"GET",headers:s})).json()).data[0]})(o);if(n){this.name=n.display_name,this.login=n.login,this.id=n.id,document.title=this.name,""===this.$store.profile_images.imgUrl(n.id)&&this.$store.profile_images.setImage(n.id,n.profile_image_url);const t=await this.fetchVideos();t.data[0]&&""===t.data[0].thumbnail_url&&(t.data[0].thumbnail_url="https://vod-secure.twitch.tv/_404/404_processing_320x180.png"),this.videos=[...this.videos,...t.data],this.cursor=null!=(i=null==(e=t.pagination)?void 0:e.cursor)?i:""}this.loading=!1},async moreVideos(){var t,e;this.loading=!0;const i=await this.fetchVideos();this.videos=[...this.videos,...i.data],this.cursor=null!=(e=null==(t=i.pagination)?void 0:t.cursor)?e:"",this.loading=!1},async fetchVideos(){const t=`https://api.twitch.tv/helix/videos?user_id=${this.id}&first=10&after=${this.cursor}`;return await(await fetch(t,{method:"GET",headers:s})).json()},dateToRelative:t=>(t=>{const e=t=>{const e=Math.floor(t);return t-e>.5?Math.ceil(t):e},i=(Date.now()-t.getTime())/1e3/60,s=i/60,a=s/24,o=e(i),n=e(s),r=e(a),l=e(a/7),h=e(a/30),c=e(a/365);let d="1 minute ago";return c>0&&h>11?d=1===c?"1 year ago":`${c} years ago`:h>0&&l>4?d=1===h?"1 month ago":`${h} months ago`:l>0&&r>6?d=1===l?"1 week ago":`${l} weeks ago`:r>0&&n>23?d=1===r?"Yesterday":`${r} days ago`:n>0&&o>59?d=1===n?"1 hour ago":`${n} hours ago`:o>1&&(d=`${o} minutes ago`),d})(t),getImageSrc:(t,e,i)=>t.replace("%{width}",e.toString()).replace("%{height}",i.toString())}})),t.data("pathContent",(function(){return{html:"",loading:!1,async init(){this.loading=!0;const e=document.querySelector("main");window.addEventListener("set-main",(async i=>{if(i.detail.path===decodeURIComponent(location.pathname))return;this.loading=!0,history.replaceState({html:this.html},"",location.pathname);const s=await fetch(i.detail.getUrl,{method:"GET"});t.disableEffectScheduling((()=>this.html="")),this.html=await s.text(),history.pushState({html:this.html},"",i.detail.path),this.loading=!1,e.focus()})),window.addEventListener("popstate",(e=>{t.disableEffectScheduling((()=>this.html="")),this.html=e.state.html}));const s=await fetch(i(),{method:"GET"});this.html=await s.text(),history.replaceState({html:this.html},"",location.pathname),this.loading=!1}}})),t.data("topGames",(function(){return{games:[],cursor:"",loading:!1,async init(){this.moreGames()},async moreGames(){var t,e;this.loading=!0;const i=await this.fetchCategories();this.games=[...this.games,...i.data],this.cursor=null!=(e=null==(t=i.pagination)?void 0:t.cursor)?e:"",this.loading=!1},async fetchCategories(){const t=`https://api.twitch.tv/helix/games/top?first=5&after=${this.cursor}`,e=await fetch(t,{method:"GET",headers:s});return await e.json()},getImageSrc:(t,e,i)=>a(t,e,i)}}))})),document.addEventListener("alpine:init",(function(){var e,i,a,n,r,l;const h={data:JSON.parse(null!=(e=localStorage.getItem("games"))?e:"[]"),ids:[],init(){t.effect((()=>{this.ids=this.data.map((({id:t})=>t)),localStorage.setItem("games",JSON.stringify(this.data))}))},hasId(t){return this.ids.includes(t)},toggle(t,e){return this.hasId(t)?(this.remove(t),!1):(this.add(t,e),!0)},add(t,e){let i=0;for(const{name:s}of this.data){if(e<s)break;i+=1}this.data.splice(i,0,{id:t,name:e})},remove(t){const e=this.ids.indexOf(t);-1!==e&&this.data.splice(e,1)}},c=async t=>{if(0===t.length)return[];const e=`https://api.twitch.tv/helix/streams?user_id=${t.join("&user_id=")}&first=100`;return(await(await fetch(e,{method:"GET",headers:s})).json()).data},d="streams",g="streams.live",m="streams.live.last_check",u=3e5,f={data:JSON.parse(null!=(i=localStorage.getItem(d))?i:"[]"),ids:[],live:JSON.parse(null!=(a=localStorage.getItem("streams.live"))?a:"{}"),liveLastCheck:parseInt(JSON.parse(null!=(n=localStorage.getItem(m))?n:Date.now().toString()),10),init(){t.effect((()=>{this.ids=this.data.map((({user_id:t})=>t)),localStorage.setItem(d,JSON.stringify(this.data))})),t.effect((()=>{localStorage.setItem(g,JSON.stringify(this.live))})),t.effect((()=>{localStorage.setItem(m,JSON.stringify(this.liveLastCheck))}));const e=()=>{this.updateUserLiveness(this.ids),setTimeout(e,299999)};e()},hasId(t){return this.ids.includes(t)},toggle(t,e,i){return this.hasId(t)?(this.remove(t),!1):(this.add(t,e,i),this.addLiveUser(t),!0)},add(t,e,i){let s=0;for(const{user_login:a}of this.data){if(e<a)break;s+=1}this.data.splice(s,0,{user_id:t,user_login:e,user_name:i})},remove(t){const e=this.ids.indexOf(t);-1!==e&&this.data.splice(e,1)},isLive(t){return void 0!==this.live[t]},async addLiveUser(t){if(void 0===this.live[t]){const e=(await c([t]))[0];e&&(this.live[e.user_id]=e.game_name)}},async updateUserLiveness(t){if(0===t.length)return;const e=Date.now();if(e<this.liveLastCheck+u)return;const i=Math.ceil(t.length/100);let s={};for(let a=0;a<i;a+=1){const e=100*a,i=e+100,o=await c(t.slice(e,i));for(const{user_id:t,game_name:a}of o)s[t]=a}this.live=s,this.liveLastCheck=e}},p={data:JSON.parse(null!=(r=localStorage.getItem("profile_images"))?r:"{}"),lastUpdate:parseInt(JSON.parse(null!=(l=localStorage.getItem("profile_images_last_update"))?l:Date.now().toString()),10),init(){const e=Object.keys(this.data),i=f.data.map((({user_id:t})=>t)).filter((t=>!e.includes(t)));i.length>0&&this.fetchProfileImages(i),t.effect((()=>{localStorage.setItem("profile_images",JSON.stringify(this.data))})),t.effect((()=>{localStorage.setItem("profile_images_last_update",JSON.stringify(this.lastUpdate))})),window.addEventListener("unload",(()=>this.clean()))},hasId(t){return void 0!==this.data[t]},imgUrl(t){const e=this.data[t];return e?(e.last_access=Date.now(),e.url):""},setImage(t,e){this.data[t]={url:e,last_access:Date.now()}},async fetchProfileImages(t){if(0===t.length)return;const e=Date.now(),i=Math.ceil(t.length/100);for(let s=0;s<i;s+=1){const i=100*s,a=i+100,n=await o(t.slice(i,a));let r={};for(let{id:t,profile_image_url:s}of n)r[t]={url:s,last_access:e};this.data={...this.data,...r}}},clean(t=[]){const e=864e5,i=Date.now();if(i-this.lastUpdate>=e){const s=Object.keys(this.data).filter((e=>!t.includes(e)));for(let t of s)i-this.data[t].last_access>e&&delete this.data[t]}this.lastUpdate=i}};t.store("games",h),t.store("streams",f),t.store("profile_images",p)}))}const a=(t,e,i)=>`https://static-cdn.jtvnw.net/ttv-boxart/${t}-${e}x${i}.jpg`;(async()=>{var e;let i=localStorage.getItem("twitch_token");if(window.location.hash)for(const t of window.location.hash.slice(1).split("&")){const[e,s]=t.split("=");if("access_token"===e){i=s,localStorage.setItem("twitch_token",s);break}}if(i)s(i),t.start(),(()=>{const t=document.querySelectorAll(".scrollbox");for(const e of t){const t=e.closest(".scroll-container"),i=e.querySelector("ul");let s=!1;const a=e=>{if(!s){const a=e.target;window.requestAnimationFrame((function(){a.scrollTop>0?t.classList.add("has-top-shadow"):t.classList.remove("has-top-shadow"),a.scrollTop+a.offsetHeight<i.offsetHeight?t.classList.add("has-bottom-shadow"):t.classList.remove("has-bottom-shadow"),s=!1})),s=!0}};e.addEventListener("scroll",a)}})();else{const t=document.querySelector(".js-twitch-login");null==(e=t.parentElement)||e.classList.remove("hidden"),t.href=`https://id.twitch.tv/oauth2/authorize?client_id=7v5r973dmjp0nd1g43b8hcocj2airz&redirect_uri=${window.location.origin+window.location.pathname}&response_type=token&scope=`}})();
